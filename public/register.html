<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Registration - Learning Coach Center Tutoring</title>
    <!-- Gill Sans MT is a system font, no external imports needed -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Gill Sans MT', 'Gill Sans', 'Calibri', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            padding: 20px 20px 60px 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .logo-container {
            margin-bottom: 20px;
        }

        .logo {
            max-width: 120px;
            max-height: 80px;
            width: auto;
            height: auto;
            filter: brightness(1.1) contrast(1.1);
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .form-container {
            padding: 40px 40px 60px 40px;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.4rem;
            color: #764ba2;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .section-title i {
            margin-right: 10px;
            color: #f093fb;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .required {
            color: #ff6b6b;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            font-family: 'Gill Sans MT', 'Gill Sans', 'Calibri', sans-serif;
        }

        .form-control:focus {
            outline: none;
            border-color: #f093fb;
        }

        .form-control.error {
            border-color: #dc3545;
            background-color: #fff5f5;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
        }

        .form-control.success {
            border-color: #28a745;
            background-color: #f8fff9;
        }

        .error-message {
            color: #721c24;
            font-size: 14px;
            margin-top: 8px;
            margin-bottom: 10px;
            display: none;
            font-weight: 600;
            background: #f8d7da;
            padding: 12px 15px;
            border: 2px solid #dc3545;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.2);
            position: relative;
            z-index: 10;
        }

        .error-message.show {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            animation: errorSlideIn 0.4s ease-out;
        }
        
        @keyframes errorSlideIn {
            from { 
                opacity: 0; 
                transform: translateY(-10px); 
                max-height: 0;
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
                max-height: 100px;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .validation-summary {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            display: none;
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
            position: relative;
            z-index: 100;
        }

        .validation-summary.show {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            animation: slideDown 0.4s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .validation-summary h4 {
            color: #856404;
            margin: 0 0 10px 0;
            font-size: 16px;
        }

        .validation-summary ul {
            margin: 0;
            padding-left: 20px;
            color: #856404;
        }

        .validation-summary li {
            margin-bottom: 5px;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 8px;
        }

        .time-preferences {
            background: #002147;
            border: 1px solid #003366;
            padding: 20px;
            border-radius: 10px;
            margin-top: 10px;
            box-shadow: 0 8px 32px rgba(0, 33, 71, 0.3);
            color: white;
        }

        .schedule-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .day-time-row {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 15px;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid #e0e0e0;
        }

        .day-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .day-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #002147;
        }

        .day-checkbox label {
            font-weight: 600;
            margin: 0;
            cursor: pointer;
            color: #333;
        }

        .time-input:disabled {
            background-color: #f5f5f5;
            color: #999;
            cursor: not-allowed;
        }

        .time-input:enabled {
            background-color: white;
            border: 2px solid #002147;
        }

        .btn {
            display: inline-block;
            padding: 15px 40px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-family: 'Gill Sans MT', 'Gill Sans', 'Calibri', sans-serif;
        }

        .btn-primary {
            background: #002147;
            border: 1px solid #003366;
            color: white;
            width: 100%;
            box-shadow: 0 8px 32px rgba(0, 33, 71, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }

        .btn-primary:hover {
            background: #003366;
            border: 1px solid #004488;
            box-shadow: 0 15px 35px rgba(0, 33, 71, 0.5);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .back-link {
            color: #f093fb;
            text-decoration: none;
            font-weight: 600;
            margin-bottom: 20px;
            display: inline-flex;
            align-items: center;
        }

        .back-link i {
            margin-right: 8px;
        }

        .back-link:hover {
            color: #764ba2;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-success {
            background: linear-gradient(135deg, #d4f6da 0%, #c3e6cb 100%);
            color: #155724;
            border: 2px solid #28a745;
            box-shadow: 0 8px 32px rgba(21, 87, 36, 0.3);
            font-size: 18px;
            animation: successPulse 0.5s ease-in-out;
        }
        
        @keyframes successPulse {
            0% { transform: scale(0.95); opacity: 0; }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Modal Dialog Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 10% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.4s ease-out;
            position: relative;
            overflow: hidden;
        }

        @keyframes modalSlideIn {
            from { 
                opacity: 0; 
                transform: translateY(-50px) scale(0.8); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }

        .modal-header {
            padding: 25px 25px 0 25px;
            text-align: center;
        }

        .modal-header.success {
            background: linear-gradient(135deg, #d4f6da 0%, #c3e6cb 100%);
            color: #155724;
        }

        .modal-header.warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404;
        }

        .modal-header.error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
        }

        .modal-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            animation: iconBounce 0.6s ease-out 0.2s both;
        }

        @keyframes iconBounce {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin: 0 0 10px 0;
        }

        .modal-body {
            padding: 20px 25px;
            text-align: center;
        }

        .modal-message {
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 25px;
        }

        .modal-footer {
            padding: 0 25px 25px 25px;
            text-align: center;
        }

        .modal-btn {
            background: #002147;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .modal-btn:hover {
            background: #003366;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 33, 71, 0.4);
        }

        .modal-btn.warning {
            background: #ffc107;
            color: #212529;
        }

        .modal-btn.warning:hover {
            background: #e0a800;
            box-shadow: 0 8px 25px rgba(255, 193, 7, 0.4);
        }

        .modal-btn.error {
            background: #dc3545;
        }

        .modal-btn.error:hover {
            background: #c82333;
            box-shadow: 0 8px 25px rgba(220, 53, 69, 0.4);
        }

        .close {
            position: absolute;
            right: 15px;
            top: 15px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            z-index: 1;
        }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            box-shadow: 0 8px 32px rgba(114, 28, 36, 0.2);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #f093fb;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .form-container {
                padding: 20px 20px 40px 20px;
            }
            
            .day-time-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .day-checkbox {
                justify-content: center;
            }

            body {
                padding: 15px 15px 80px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                                 <img src="/logo.png" alt="Learning Coach Center Tutoring Logo" class="logo" onload="console.log('Logo loaded successfully')" onerror="console.log('Logo failed to load, hiding'); this.style.display='none'">
            </div>
            <h1>🎓 Student Registration</h1>
            <p>Join our expert tutoring program and excel in mathematics!</p>
        </div>

        <div class="form-container">
            <a href="/" class="back-link">
                <i class="fas fa-arrow-left"></i> Back to Home
            </a>

            <div id="alertContainer"></div>
            
            <!-- Validation Summary -->
            <div id="validationSummary" class="validation-summary">
                <h4><i class="fas fa-exclamation-triangle"></i> Please fix the following issues:</h4>
                <ul id="validationList"></ul>
            </div>
            
            <div class="loading" id="loadingIndicator">
                <div class="spinner"></div>
                <p>Submitting your registration...</p>
            </div>

            <!-- Modal Dialog -->
            <div id="responseModal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <div id="modalHeader" class="modal-header">
                        <div id="modalIcon" class="modal-icon"></div>
                        <h2 id="modalTitle" class="modal-title"></h2>
                    </div>
                    <div class="modal-body">
                        <p id="modalMessage" class="modal-message"></p>
                    </div>
                    <div class="modal-footer">
                        <button id="modalBtn" class="modal-btn">OK</button>
                    </div>
                </div>
            </div>

            <form id="registrationForm">
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-user"></i>
                        Student Information
                    </h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstName">First Name <span class="required">*</span></label>
                            <input type="text" id="firstName" name="firstName" class="form-control" required>
                            <div class="error-message" id="firstName-error"></div>
                        </div>
                        <div class="form-group">
                            <label for="lastName">Last Name <span class="required">*</span></label>
                            <input type="text" id="lastName" name="lastName" class="form-control" required>
                            <div class="error-message" id="lastName-error"></div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="email">Email Address <span class="required">*</span></label>
                            <input type="email" id="email" name="email" class="form-control" required>
                            <div class="error-message" id="email-error"></div>
                        </div>
                        <div class="form-group">
                            <label for="phone">Phone Number <span class="required">*</span></label>
                            <input type="tel" id="phone" name="phone" class="form-control" placeholder="e.g., 7144008283" required 
                                   maxlength="15" 
                                   onkeypress="return isDigitOnly(event)"
                                   oninput="formatPhoneDigits(this)"
                                   onpaste="handlePhonePaste(event)">
                            <div class="error-message" id="phone-error"></div>
                            <div class="field-helper" style="font-size: 12px; color: #666; margin-top: 5px;">
                                📱 Enter digits only (10-15 digits)
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="grade">Current Grade Level <span class="required">*</span></label>
                        <select id="grade" name="grade" class="form-control" required>
                            <option value="">Select your grade level</option>
                            <option value="6th">6th Grade</option>
                            <option value="7th">7th Grade</option>
                            <option value="8th">8th Grade</option>
                            <option value="9th">9th Grade</option>
                            <option value="10th">10th Grade</option>
                            <option value="11th">11th Grade</option>
                            <option value="12th">12th Grade</option>
                            <option value="College">College</option>
                            <option value="Graduate">Graduate School</option>
                        </select>
                        <div class="error-message" id="grade-error"></div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="country">Country <span class="required">*</span></label>
                            <select id="country" name="country" class="form-control" required>
                                <option value="">Select your country</option>
                                <option value="United States">🇺🇸 United States</option>
                                <option value="Canada">🇨🇦 Canada</option>
                                <option value="United Kingdom">🇬🇧 United Kingdom</option>
                                <option value="Australia">🇦🇺 Australia</option>
                                <option value="New Zealand">🇳🇿 New Zealand</option>
                                <option value="India">🇮🇳 India</option>
                                <option value="Singapore">🇸🇬 Singapore</option>
                                <option value="United Arab Emirates">🇦🇪 United Arab Emirates</option>
                                <option value="Saudi Arabia">🇸🇦 Saudi Arabia</option>
                                <option value="Qatar">🇶🇦 Qatar</option>
                                <option value="Kuwait">🇰🇼 Kuwait</option>
                                <option value="Germany">🇩🇪 Germany</option>
                                <option value="France">🇫🇷 France</option>
                                <option value="Netherlands">🇳🇱 Netherlands</option>
                                <option value="Switzerland">🇨🇭 Switzerland</option>
                                <option value="Sweden">🇸🇪 Sweden</option>
                                <option value="Norway">🇳🇴 Norway</option>
                                <option value="Japan">🇯🇵 Japan</option>
                                <option value="South Korea">🇰🇷 South Korea</option>
                                <option value="China">🇨🇳 China</option>
                                <option value="Hong Kong">🇭🇰 Hong Kong</option>
                                <option value="Malaysia">🇲🇾 Malaysia</option>
                                <option value="Thailand">🇹🇭 Thailand</option>
                                <option value="Philippines">🇵🇭 Philippines</option>
                                <option value="Indonesia">🇮🇩 Indonesia</option>
                                <option value="Vietnam">🇻🇳 Vietnam</option>
                                <option value="Bangladesh">🇧🇩 Bangladesh</option>
                                <option value="Pakistan">🇵🇰 Pakistan</option>
                                <option value="Sri Lanka">🇱🇰 Sri Lanka</option>
                                <option value="Nepal">🇳🇵 Nepal</option>
                                <option value="Mexico">🇲🇽 Mexico</option>
                                <option value="Brazil">🇧🇷 Brazil</option>
                                <option value="Argentina">🇦🇷 Argentina</option>
                                <option value="Chile">🇨🇱 Chile</option>
                                <option value="Colombia">🇨🇴 Colombia</option>
                                <option value="Peru">🇵🇪 Peru</option>
                                <option value="South Africa">🇿🇦 South Africa</option>
                                <option value="Nigeria">🇳🇬 Nigeria</option>
                                <option value="Egypt">🇪🇬 Egypt</option>
                                <option value="Morocco">🇲🇦 Morocco</option>
                                <option value="Turkey">🇹🇷 Turkey</option>
                                <option value="Israel">🇮🇱 Israel</option>
                                <option value="Jordan">🇯🇴 Jordan</option>
                                <option value="Lebanon">🇱🇧 Lebanon</option>
                                <option value="Other">🌍 Other</option>
                            </select>
                            <div class="error-message" id="country-error"></div>
                        </div>
                        <div class="form-group">
                            <label for="timezone">Time Zone <span class="required">*</span></label>
                            <p id="timezoneHelper" style="font-size: 12px; color: #888; margin-bottom: 5px;">Please select a country first</p>
                            <select id="timezone" name="timezone" class="form-control" required>
                                <option value="">First select your country above</option>
                            </select>
                            <div class="error-message" id="timezone-error"></div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-book"></i>
                        Subject Selection
                    </h3>
                    
                    <div class="form-group">
                        <label>Select subjects you need help with <span class="required">*</span></label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="algebra" name="subjects" value="Algebra">
                                <label for="algebra">Algebra</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="geometry" name="subjects" value="Geometry">
                                <label for="geometry">Geometry</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="precalculus" name="subjects" value="Pre-Calculus">
                                <label for="precalculus">Pre-Calculus</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="calculus" name="subjects" value="Calculus">
                                <label for="calculus">Calculus</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="apcalcab" name="subjects" value="AP Calculus AB">
                                <label for="apcalcab">AP Calculus AB</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="apcalcbc" name="subjects" value="AP Calculus BC">
                                <label for="apcalcbc">AP Calculus BC</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="apstats" name="subjects" value="AP Statistics">
                                <label for="apstats">AP Statistics</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="linearalgebra" name="subjects" value="Linear Algebra">
                                <label for="linearalgebra">Linear Algebra</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="multicalc" name="subjects" value="Multivariable Calculus">
                                <label for="multicalc">Multivariable Calculus</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="diffeq" name="subjects" value="Differential Equations">
                                <label for="diffeq">Differential Equations</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="ibhl" name="subjects" value="IB Math HL">
                                <label for="ibhl">IB Math HL</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="ibsl" name="subjects" value="IB Math SL">
                                <label for="ibsl">IB Math SL</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="biology" name="subjects" value="Biology">
                                <label for="biology">Biology</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="apbiology" name="subjects" value="AP Biology">
                                <label for="apbiology">AP Biology</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="chemistry" name="subjects" value="Chemistry">
                                <label for="chemistry">Chemistry</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="apchemistry" name="subjects" value="AP Chemistry">
                                <label for="apchemistry">AP Chemistry</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="physics" name="subjects" value="Physics">
                                <label for="physics">Physics</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="apphysics1" name="subjects" value="AP Physics 1">
                                <label for="apphysics1">AP Physics 1</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="apphysics2" name="subjects" value="AP Physics 2">
                                <label for="apphysics2">AP Physics 2</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="apphysicsc1" name="subjects" value="AP Physics C (Mechanics)">
                                <label for="apphysicsc1">AP Physics C (Mechanics)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="apphysicsc2" name="subjects" value="AP Physics C (E&M)">
                                <label for="apphysicsc2">AP Physics C (E&M)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="english" name="subjects" value="English">
                                <label for="english">English</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="apenglang" name="subjects" value="AP English Language">
                                <label for="apenglang">AP English Language</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="apenglit" name="subjects" value="AP English Literature">
                                <label for="apenglit">AP English Literature</label>
                            </div>
                        </div>
                        <div class="error-message" id="subjects-error" style="margin-top: 15px;">
                            <!-- Subjects error messages will appear here -->
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-clock"></i>
                        Schedule Preferences
                    </h3>
                    
                    <div class="form-group">
                        <label>Select your preferred days and times (optional)</label>
                        <p style="font-size: 14px; color: #666; margin-bottom: 20px;">Note: Times will be coordinated based on your time zone. You can select multiple days.</p>
                        
                        <div class="schedule-grid">
                            <div class="day-time-row">
                                <div class="day-checkbox">
                                    <input type="checkbox" id="monday" name="scheduleDay" value="Monday">
                                    <label for="monday">Monday</label>
                                </div>
                                <input type="text" name="mondayTime" class="form-control time-input" placeholder="e.g., 3:00 PM - 4:00 PM" disabled>
                            </div>
                            
                            <div class="day-time-row">
                                <div class="day-checkbox">
                                    <input type="checkbox" id="tuesday" name="scheduleDay" value="Tuesday">
                                    <label for="tuesday">Tuesday</label>
                                </div>
                                <input type="text" name="tuesdayTime" class="form-control time-input" placeholder="e.g., 3:00 PM - 4:00 PM" disabled>
                            </div>
                            
                            <div class="day-time-row">
                                <div class="day-checkbox">
                                    <input type="checkbox" id="wednesday" name="scheduleDay" value="Wednesday">
                                    <label for="wednesday">Wednesday</label>
                                </div>
                                <input type="text" name="wednesdayTime" class="form-control time-input" placeholder="e.g., 3:00 PM - 4:00 PM" disabled>
                            </div>
                            
                            <div class="day-time-row">
                                <div class="day-checkbox">
                                    <input type="checkbox" id="thursday" name="scheduleDay" value="Thursday">
                                    <label for="thursday">Thursday</label>
                                </div>
                                <input type="text" name="thursdayTime" class="form-control time-input" placeholder="e.g., 3:00 PM - 4:00 PM" disabled>
                            </div>
                            
                            <div class="day-time-row">
                                <div class="day-checkbox">
                                    <input type="checkbox" id="friday" name="scheduleDay" value="Friday">
                                    <label for="friday">Friday</label>
                                </div>
                                <input type="text" name="fridayTime" class="form-control time-input" placeholder="e.g., 3:00 PM - 4:00 PM" disabled>
                            </div>
                            
                            <div class="day-time-row">
                                <div class="day-checkbox">
                                    <input type="checkbox" id="saturday" name="scheduleDay" value="Saturday">
                                    <label for="saturday">Saturday</label>
                                </div>
                                <input type="text" name="saturdayTime" class="form-control time-input" placeholder="e.g., 10:00 AM - 11:00 AM" disabled>
                            </div>
                            
                            <div class="day-time-row">
                                <div class="day-checkbox">
                                    <input type="checkbox" id="sunday" name="scheduleDay" value="Sunday">
                                    <label for="sunday">Sunday</label>
                                </div>
                                <input type="text" name="sundayTime" class="form-control time-input" placeholder="e.g., 10:00 AM - 11:00 AM" disabled>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-users"></i>
                        Parent/Guardian Information (Optional)
                    </h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="parentName">Parent/Guardian Name</label>
                            <input type="text" id="parentName" name="parentName" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="parentPhone">Parent/Guardian Phone</label>
                            <input type="tel" id="parentPhone" name="parentPhone" class="form-control" placeholder="e.g., 7144008283" 
                                   maxlength="15" 
                                   onkeypress="return isDigitOnly(event)"
                                   oninput="formatPhoneDigits(this)"
                                   onpaste="handlePhonePaste(event)">
                            <div class="error-message" id="parentPhone-error"></div>
                            <div class="field-helper" style="font-size: 12px; color: #666; margin-top: 5px;">
                                📱 Enter digits only (10-15 digits)
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="parentEmail">Parent/Guardian Email</label>
                        <input type="email" id="parentEmail" name="parentEmail" class="form-control">
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-target"></i>
                        Goals & Experience
                    </h3>
                    
                    <div class="form-group">
                        <label for="goals">What are your learning goals? (Optional)</label>
                        <textarea id="goals" name="goals" class="form-control" rows="3" placeholder="e.g., Improve test scores, prepare for AP exams, understand concepts better..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="experience">Previous tutoring experience or areas of difficulty? (Optional)</label>
                        <textarea id="experience" name="experience" class="form-control" rows="3" placeholder="e.g., Struggled with algebra, had tutoring before, specific topics that are challenging..."></textarea>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary" id="submitBtn">
                    <i class="fas fa-paper-plane"></i> Submit Registration
                </button>
                
                <!-- Test validation button (remove in production) -->
                <button type="button" onclick="testValidation()" style="margin-top: 15px; width: 100%; padding: 15px; background: #ffc107; color: #000; border: 2px solid #ffb800; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer;">
                    🧪 CLICK HERE TO TEST ERROR DISPLAY
                </button>
            </form>
        </div>
    </div>

    <script>
        // Modal functions
        function showModal(type, title, message, callback = null) {
            console.log('🔧 showModal called with:', { type, title, message: message.substring(0, 50) + '...' });
            
            try {
                const modal = document.getElementById('responseModal');
                const modalHeader = document.getElementById('modalHeader');
                const modalIcon = document.getElementById('modalIcon');
                const modalTitle = document.getElementById('modalTitle');
                const modalMessage = document.getElementById('modalMessage');
                const modalBtn = document.getElementById('modalBtn');
                
                console.log('🔍 Modal elements found:', {
                    modal: !!modal,
                    modalHeader: !!modalHeader,
                    modalIcon: !!modalIcon,
                    modalTitle: !!modalTitle,
                    modalMessage: !!modalMessage,
                    modalBtn: !!modalBtn
                });
                
                if (!modal) {
                    console.error('❌ Modal element not found!');
                    alert('Error: Modal not found. Please refresh the page and try again.');
                    return;
                }
                
                // Reset classes
                if (modalHeader) {
                    modalHeader.className = 'modal-header';
                }
                if (modalBtn) {
                    modalBtn.className = 'modal-btn';
                }
                
                if (type === 'success') {
                    console.log('✅ Setting up success modal');
                    if (modalHeader) modalHeader.classList.add('success');
                    if (modalIcon) modalIcon.innerHTML = '<i class="fas fa-check-circle"></i>';
                    if (modalTitle) modalTitle.textContent = title;
                    if (modalMessage) modalMessage.innerHTML = message;
                } else if (type === 'warning') {
                    console.log('⚠️ Setting up warning modal');
                    if (modalHeader) modalHeader.classList.add('warning');
                    if (modalBtn) modalBtn.classList.add('warning');
                    if (modalIcon) modalIcon.innerHTML = '<i class="fas fa-exclamation-triangle"></i>';
                    if (modalTitle) modalTitle.textContent = title;
                    if (modalMessage) modalMessage.innerHTML = message;
                } else if (type === 'error') {
                    console.log('❌ Setting up error modal');
                    if (modalHeader) modalHeader.classList.add('error');
                    if (modalBtn) modalBtn.classList.add('error');
                    if (modalIcon) modalIcon.innerHTML = '<i class="fas fa-times-circle"></i>';
                    if (modalTitle) modalTitle.textContent = title;
                    if (modalMessage) modalMessage.innerHTML = message;
                }
                
                // Force display with multiple methods
                modal.style.display = 'block';
                modal.style.visibility = 'visible';
                modal.style.opacity = '1';
                modal.style.zIndex = '9999';
                
                console.log('👁️ Modal display set to:', {
                    display: modal.style.display,
                    visibility: modal.style.visibility,
                    opacity: modal.style.opacity,
                    zIndex: modal.style.zIndex,
                    offsetHeight: modal.offsetHeight,
                    offsetWidth: modal.offsetWidth
                });
                
                // Handle modal close
                const handleClose = () => {
                    console.log('🔄 Closing modal');
                    modal.style.display = 'none';
                    if (callback) callback();
                };
                
                if (modalBtn) {
                    modalBtn.onclick = handleClose;
                }
                
                const closeBtn = modal.querySelector('.close');
                if (closeBtn) {
                    closeBtn.onclick = handleClose;
                }
                
                // Close on outside click
                window.onclick = function(event) {
                    if (event.target === modal) {
                        handleClose();
                    }
                };
                
                // Close on escape key
                document.addEventListener('keydown', function(event) {
                    if (event.key === 'Escape' && modal.style.display === 'block') {
                        handleClose();
                    }
                });
                
                console.log('✅ Modal setup complete');
                
            } catch (error) {
                console.error('💥 Error in showModal:', error);
                alert(`Error displaying modal: ${error.message}\n\nOriginal message: ${title}\n${message.replace(/<[^>]*>/g, '')}`);
            }
        }

        // Country to timezone mapping
        const countryTimezones = {
            'United States': [
                'Pacific/Honolulu', 'America/Anchorage', 'America/Los_Angeles', 
                'America/Denver', 'America/Chicago', 'America/New_York'
            ],
            'Canada': [
                'America/Vancouver', 'America/Denver', 'America/Chicago', 
                'America/Toronto', 'America/Halifax', 'America/St_Johns'
            ],
            'United Kingdom': ['Europe/London'],
            'Australia': ['Australia/Perth', 'Australia/Sydney', 'Australia/Melbourne'],
            'New Zealand': ['Pacific/Auckland'],
            'India': ['Asia/Kolkata'],
            'Singapore': ['Asia/Singapore'],
            'United Arab Emirates': ['Asia/Dubai'],
            'Saudi Arabia': ['Asia/Riyadh'],
            'Qatar': ['Asia/Qatar'],
            'Kuwait': ['Asia/Kuwait'],
            'Germany': ['Europe/Berlin'],
            'France': ['Europe/Paris'],
            'Netherlands': ['Europe/Amsterdam'],
            'Switzerland': ['Europe/Zurich'],
            'Sweden': ['Europe/Stockholm'],
            'Norway': ['Europe/Oslo'],
            'Japan': ['Asia/Tokyo'],
            'South Korea': ['Asia/Seoul'],
            'China': ['Asia/Shanghai'],
            'Hong Kong': ['Asia/Hong_Kong'],
            'Malaysia': ['Asia/Kuala_Lumpur'],
            'Thailand': ['Asia/Bangkok'],
            'Philippines': ['Asia/Manila'],
            'Indonesia': ['Asia/Jakarta'],
            'Vietnam': ['Asia/Ho_Chi_Minh'],
            'Bangladesh': ['Asia/Dhaka'],
            'Pakistan': ['Asia/Karachi'],
            'Sri Lanka': ['Asia/Colombo'],
            'Nepal': ['Asia/Kathmandu'],
            'Mexico': ['America/Mexico_City'],
            'Brazil': ['America/Sao_Paulo'],
            'Argentina': ['America/Argentina/Buenos_Aires'],
            'Chile': ['America/Santiago'],
            'Colombia': ['America/Bogota'],
            'Peru': ['America/Lima'],
            'South Africa': ['Africa/Johannesburg'],
            'Nigeria': ['Africa/Lagos'],
            'Egypt': ['Africa/Cairo'],
            'Morocco': ['Africa/Casablanca'],
            'Turkey': ['Europe/Istanbul'],
            'Israel': ['Asia/Jerusalem'],
            'Jordan': ['Asia/Amman'],
            'Lebanon': ['Asia/Beirut']
        };

        // All timezone options with labels
        const allTimezones = [
            { value: 'Pacific/Honolulu', label: '🌺 Hawaii (HST, UTC-10)' },
            { value: 'America/Anchorage', label: '❄️ Alaska (AKST, UTC-9)' },
            { value: 'America/Los_Angeles', label: '🌴 Pacific (PST/PDT, UTC-8/-7)' },
            { value: 'America/Denver', label: '🏔️ Mountain (MST/MDT, UTC-7/-6)' },
            { value: 'America/Chicago', label: '🌾 Central (CST/CDT, UTC-6/-5)' },
            { value: 'America/New_York', label: '🗽 Eastern (EST/EDT, UTC-5/-4)' },
            { value: 'America/Halifax', label: '🍁 Atlantic (AST/ADT, UTC-4/-3)' },
            { value: 'America/St_Johns', label: '🐧 Newfoundland (NST/NDT, UTC-3:30/-2:30)' },
            { value: 'America/Toronto', label: '🍁 Toronto (EST/EDT, UTC-5/-4)' },
            { value: 'America/Vancouver', label: '🍁 Vancouver (PST/PDT, UTC-8/-7)' },
            { value: 'Europe/London', label: '🇬🇧 London (GMT/BST, UTC+0/+1)' },
            { value: 'Europe/Paris', label: '🇫🇷 Paris (CET/CEST, UTC+1/+2)' },
            { value: 'Europe/Berlin', label: '🇩🇪 Berlin (CET/CEST, UTC+1/+2)' },
            { value: 'Europe/Rome', label: '🇮🇹 Rome (CET/CEST, UTC+1/+2)' },
            { value: 'Europe/Amsterdam', label: '🇳🇱 Amsterdam (CET/CEST, UTC+1/+2)' },
            { value: 'Europe/Zurich', label: '🇨🇭 Zurich (CET/CEST, UTC+1/+2)' },
            { value: 'Europe/Stockholm', label: '🇸🇪 Stockholm (CET/CEST, UTC+1/+2)' },
            { value: 'Europe/Oslo', label: '🇳🇴 Oslo (CET/CEST, UTC+1/+2)' },
            { value: 'Asia/Dubai', label: '🇦🇪 Dubai (GST, UTC+4)' },
            { value: 'Asia/Riyadh', label: '🇸🇦 Riyadh (AST, UTC+3)' },
            { value: 'Asia/Qatar', label: '🇶🇦 Qatar (AST, UTC+3)' },
            { value: 'Asia/Kuwait', label: '🇰🇼 Kuwait (AST, UTC+3)' },
            { value: 'Asia/Kolkata', label: '🇮🇳 India (IST, UTC+5:30)' },
            { value: 'Asia/Dhaka', label: '🇧🇩 Bangladesh (BST, UTC+6)' },
            { value: 'Asia/Karachi', label: '🇵🇰 Pakistan (PKT, UTC+5)' },
            { value: 'Asia/Colombo', label: '🇱🇰 Sri Lanka (SLST, UTC+5:30)' },
            { value: 'Asia/Kathmandu', label: '🇳🇵 Nepal (NPT, UTC+5:45)' },
            { value: 'Asia/Singapore', label: '🇸🇬 Singapore (SGT, UTC+8)' },
            { value: 'Asia/Hong_Kong', label: '🇭🇰 Hong Kong (HKT, UTC+8)' },
            { value: 'Asia/Shanghai', label: '🇨🇳 China (CST, UTC+8)' },
            { value: 'Asia/Tokyo', label: '🇯🇵 Japan (JST, UTC+9)' },
            { value: 'Asia/Seoul', label: '🇰🇷 South Korea (KST, UTC+9)' },
            { value: 'Asia/Kuala_Lumpur', label: '🇲🇾 Malaysia (MYT, UTC+8)' },
            { value: 'Asia/Bangkok', label: '🇹🇭 Thailand (ICT, UTC+7)' },
            { value: 'Asia/Manila', label: '🇵🇭 Philippines (PST, UTC+8)' },
            { value: 'Asia/Jakarta', label: '🇮🇩 Indonesia (WIB, UTC+7)' },
            { value: 'Asia/Ho_Chi_Minh', label: '🇻🇳 Vietnam (ICT, UTC+7)' },
            { value: 'Australia/Sydney', label: '🇦🇺 Sydney (AEST/AEDT, UTC+10/+11)' },
            { value: 'Australia/Melbourne', label: '🇦🇺 Melbourne (AEST/AEDT, UTC+10/+11)' },
            { value: 'Australia/Perth', label: '🇦🇺 Perth (AWST, UTC+8)' },
            { value: 'Pacific/Auckland', label: '🇳🇿 New Zealand (NZST/NZDT, UTC+12/+13)' },
            { value: 'America/Mexico_City', label: '🇲🇽 Mexico City (CST/CDT, UTC-6/-5)' },
            { value: 'America/Sao_Paulo', label: '🇧🇷 São Paulo (BRT/BRST, UTC-3/-2)' },
            { value: 'America/Argentina/Buenos_Aires', label: '🇦🇷 Buenos Aires (ART, UTC-3)' },
            { value: 'America/Santiago', label: '🇨🇱 Santiago (CLT/CLST, UTC-4/-3)' },
            { value: 'America/Bogota', label: '🇨🇴 Bogotá (COT, UTC-5)' },
            { value: 'America/Lima', label: '🇵🇪 Lima (PET, UTC-5)' },
            { value: 'Africa/Johannesburg', label: '🇿🇦 Johannesburg (SAST, UTC+2)' },
            { value: 'Africa/Lagos', label: '🇳🇬 Lagos (WAT, UTC+1)' },
            { value: 'Africa/Cairo', label: '🇪🇬 Cairo (EET, UTC+2)' },
            { value: 'Africa/Casablanca', label: '🇲🇦 Casablanca (WET, UTC+0)' },
            { value: 'Europe/Istanbul', label: '🇹🇷 Istanbul (TRT, UTC+3)' },
            { value: 'Asia/Jerusalem', label: '🇮🇱 Jerusalem (IST, UTC+2)' },
            { value: 'Asia/Amman', label: '🇯🇴 Amman (EET, UTC+2)' },
            { value: 'Asia/Beirut', label: '🇱🇧 Beirut (EET, UTC+2)' }
        ];

        function updateTimezoneOptions(selectedCountry) {
            const timezoneSelect = document.getElementById('timezone');
            const timezoneHelper = document.getElementById('timezoneHelper');
            const applicableTimezones = countryTimezones[selectedCountry] || [];
            
            // Clear existing options except the first one
            timezoneSelect.innerHTML = '<option value="">Select your time zone</option>';
            
            if (applicableTimezones.length > 0) {
                // Add only applicable timezones
                applicableTimezones.forEach(timezoneValue => {
                    const timezoneData = allTimezones.find(tz => tz.value === timezoneValue);
                    if (timezoneData) {
                        const option = document.createElement('option');
                        option.value = timezoneData.value;
                        option.textContent = timezoneData.label;
                        timezoneSelect.appendChild(option);
                    }
                });
                
                timezoneSelect.disabled = false;
                timezoneSelect.style.opacity = '1';
                timezoneHelper.textContent = `Choose your timezone in ${selectedCountry}`;
                timezoneHelper.style.color = '#002147';
            } else {
                // If country not found, show all timezones
                allTimezones.forEach(timezone => {
                    const option = document.createElement('option');
                    option.value = timezone.value;
                    option.textContent = timezone.label;
                    timezoneSelect.appendChild(option);
                });
                
                timezoneSelect.disabled = false;
                timezoneSelect.style.opacity = '1';
                timezoneHelper.textContent = 'Select your time zone from the list below';
                timezoneHelper.style.color = '#002147';
            }
        }

        // Real-time validation functions
        function validateFieldRealTime(fieldId) {
            const field = document.getElementById(fieldId);
            const value = field.value.trim();
            
            switch(fieldId) {
                case 'firstName':
                    if (!value) {
                        showFieldError(fieldId, '❌ First name is required. Please enter your first name (e.g., "John").');
                    } else if (value.length < 2) {
                        showFieldError(fieldId, '❌ First name must be at least 2 characters long.');
                    } else {
                        clearFieldError(fieldId);
                    }
                    break;
                    
                case 'lastName':
                    if (!value) {
                        showFieldError(fieldId, '❌ Last name is required. Please enter your last name (e.g., "Smith").');
                    } else if (value.length < 2) {
                        showFieldError(fieldId, '❌ Last name must be at least 2 characters long.');
                    } else {
                        clearFieldError(fieldId);
                    }
                    break;
                    
                case 'email':
                    if (!value) {
                        showFieldError(fieldId, '❌ Email address is required. Please enter your email (e.g., "john@example.com").');
                    } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
                        showFieldError(fieldId, '❌ Invalid email format. Please use format: your@email.com (include @ and domain).');
                    } else {
                        clearFieldError(fieldId);
                    }
                    break;
                    
                case 'phone':
                    if (!value) {
                        showFieldError(fieldId, '❌ Phone number is required. Enter with country code if international (e.g., "+1-555-123-4567").');
                    } else if (value.length < 10) {
                        showFieldError(fieldId, '❌ Phone number too short. Please enter at least 10 digits including country code if needed.');
                    } else {
                        clearFieldError(fieldId);
                    }
                    break;
                    
                case 'grade':
                    if (!field.value) {
                        showFieldError(fieldId, '❌ Grade level is required. Please select your current grade from the dropdown menu.');
                    } else {
                        clearFieldError(fieldId);
                    }
                    break;
                    
                case 'country':
                    if (!field.value) {
                        showFieldError(fieldId, '❌ Country is required. Please select your country from the dropdown list.');
                    } else {
                        clearFieldError(fieldId);
                    }
                    break;
                    
                case 'timezone':
                    if (!field.value) {
                        showFieldError(fieldId, '❌ Time zone is required. First select your country above, then choose your time zone.');
                    } else {
                        clearFieldError(fieldId);
                    }
                    break;
            }
        }

        // Ensure all error divs exist
        function ensureErrorDivsExist() {
            const fieldIds = ['firstName', 'lastName', 'email', 'phone', 'grade', 'country', 'timezone', 'subjects'];
            
            fieldIds.forEach(fieldId => {
                const errorDivId = fieldId + '-error';
                let errorDiv = document.getElementById(errorDivId);
                
                if (!errorDiv) {
                    console.log(`Creating missing error div for: ${fieldId}`);
                    const field = document.getElementById(fieldId);
                    
                    if (field && field.parentNode) {
                        errorDiv = document.createElement('div');
                        errorDiv.id = errorDivId;
                        errorDiv.className = 'error-message';
                        errorDiv.style.display = 'none';
                        field.parentNode.insertBefore(errorDiv, field.nextSibling);
                        console.log(`✅ Created error div: ${errorDivId}`);
                    } else if (fieldId === 'subjects') {
                        // For subjects, find the checkbox group container
                        const subjectsContainer = document.querySelector('.checkbox-group');
                        if (subjectsContainer && subjectsContainer.parentNode) {
                            errorDiv = document.createElement('div');
                            errorDiv.id = errorDivId;
                            errorDiv.className = 'error-message';
                            errorDiv.style.display = 'none';
                            errorDiv.style.marginTop = '15px';
                            subjectsContainer.parentNode.insertBefore(errorDiv, subjectsContainer.nextSibling);
                            console.log(`✅ Created subjects error div: ${errorDivId}`);
                        }
                    }
                } else {
                    console.log(`✅ Error div exists: ${errorDivId}`);
                }
            });
        }

        // Enable/disable time inputs based on day checkboxes
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 DOM Content Loaded - Initializing form...');
            
            // Ensure all error divs exist first
            ensureErrorDivsExist();
            
            const dayCheckboxes = document.querySelectorAll('input[name="scheduleDay"]');
            const countrySelect = document.getElementById('country');
            const timezoneSelect = document.getElementById('timezone');
            
            // Initially disable timezone until country is selected
            timezoneSelect.disabled = true;
            timezoneSelect.style.opacity = '0.6';
            
            // Add real-time validation to form fields
            const fieldsToValidate = ['firstName', 'lastName', 'email', 'phone', 'grade', 'country', 'timezone'];
            
            fieldsToValidate.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    // Validate on blur (when user leaves the field)
                    field.addEventListener('blur', function() {
                        if (this.value.trim() !== '') {
                            validateFieldRealTime(fieldId);
                        }
                    });
                    
                    // Clear errors on focus (when user starts typing)
                    field.addEventListener('focus', function() {
                        const errorDiv = document.getElementById(fieldId + '-error');
                        if (errorDiv && errorDiv.classList.contains('show')) {
                            // Don't clear completely, just reduce visibility to show they're working on it
                            this.classList.remove('error');
                        }
                    });
                    
                    // For dropdowns, validate immediately on change
                    if (field.tagName === 'SELECT') {
                        field.addEventListener('change', function() {
                            validateFieldRealTime(fieldId);
                        });
                    }
                }
            });
            
            // Validate subjects when checkboxes change
            const subjectCheckboxes = document.querySelectorAll('input[name="subjects"]');
            console.log('Found subject checkboxes:', subjectCheckboxes.length);
            
            subjectCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    console.log('Subject checkbox changed:', this.value, 'Checked:', this.checked);
                    
                    const checkedSubjects = document.querySelectorAll('input[name="subjects"]:checked');
                    console.log('Total checked subjects:', checkedSubjects.length);
                    
                    if (checkedSubjects.length === 0) {
                        showFieldError('subjects', '❌ At least one subject is required. Please check the boxes for subjects you need help with.');
                    } else {
                        // Clear subjects error
                        const subjectsErrorDiv = document.getElementById('subjects-error');
                        if (subjectsErrorDiv) {
                            subjectsErrorDiv.classList.remove('show');
                            subjectsErrorDiv.style.display = 'none';
                            subjectsErrorDiv.textContent = '';
                            console.log('Subjects error cleared');
                        }
                    }
                });
            });
            
            // Handle country selection change
            countrySelect.addEventListener('change', function() {
                const selectedCountry = this.value;
                const timezoneHelper = document.getElementById('timezoneHelper');
                
                if (selectedCountry) {
                    updateTimezoneOptions(selectedCountry);
                    clearFieldError('country');
                } else {
                    timezoneSelect.disabled = true;
                    timezoneSelect.style.opacity = '0.6';
                    timezoneSelect.innerHTML = '<option value="">First select your country above</option>';
                    timezoneHelper.textContent = 'Please select a country first';
                    timezoneHelper.style.color = '#888';
                }
            });
            
            // Handle day checkbox changes
            dayCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const day = this.value.toLowerCase();
                    const timeInput = document.querySelector(`input[name="${day}Time"]`);
                    
                    if (this.checked) {
                        timeInput.disabled = false;
                        timeInput.focus();
                    } else {
                        timeInput.disabled = true;
                        timeInput.value = '';
                    }
                });
            });
        });

        // Validation functions
        function showFieldError(fieldId, message) {
            const field = document.getElementById(fieldId);
            const errorDiv = document.getElementById(fieldId + '-error');
            
            console.log('Showing error for field:', fieldId, 'Message:', message);
            
            if (field) {
                field.classList.add('error');
                field.classList.remove('success');
                field.style.borderColor = '#dc3545';
                field.style.backgroundColor = '#fff5f5';
            }
            
            if (errorDiv) {
                errorDiv.innerHTML = message;
                errorDiv.classList.add('show');
                errorDiv.style.display = 'block';
                errorDiv.style.visibility = 'visible';
                errorDiv.style.opacity = '1';
                errorDiv.style.position = 'relative';
                errorDiv.style.zIndex = '999';
                
                // Force a reflow to ensure the element is rendered
                errorDiv.offsetHeight;
                
                console.log('Error div updated for:', fieldId, 'Visible:', errorDiv.offsetHeight > 0, 'Display:', errorDiv.style.display);
            } else {
                console.log('ERROR: Error div not found for field:', fieldId);
                // If error div doesn't exist, create one dynamically
                if (field && field.parentNode) {
                    const newErrorDiv = document.createElement('div');
                    newErrorDiv.id = fieldId + '-error';
                    newErrorDiv.className = 'error-message show';
                    newErrorDiv.innerHTML = message;
                    newErrorDiv.style.display = 'block';
                    newErrorDiv.style.visibility = 'visible';
                    newErrorDiv.style.opacity = '1';
                    field.parentNode.insertBefore(newErrorDiv, field.nextSibling);
                    console.log('Created new error div for:', fieldId);
                }
            }
        }

        function clearFieldError(fieldId) {
            const field = document.getElementById(fieldId);
            const errorDiv = document.getElementById(fieldId + '-error');
            
            console.log('Clearing error for field:', fieldId, 'Field found:', !!field, 'Error div found:', !!errorDiv);
            
            if (field) {
                field.classList.remove('error');
                field.classList.add('success');
                field.style.borderColor = '';
                field.style.backgroundColor = '';
            } else {
                console.log('Warning: Field not found for clearFieldError:', fieldId);
            }
            
            if (errorDiv) {
                errorDiv.classList.remove('show');
                errorDiv.style.display = 'none';
                errorDiv.textContent = '';
            } else {
                console.log('Warning: Error div not found for clearFieldError:', fieldId);
            }
        }

        function clearAllErrors() {
            const errorFields = document.querySelectorAll('.form-control.error');
            const errorMessages = document.querySelectorAll('.error-message.show');
            const validationSummary = document.getElementById('validationSummary');
            
            errorFields.forEach(field => {
                field.classList.remove('error');
            });
            
            errorMessages.forEach(msg => {
                msg.classList.remove('show');
                msg.textContent = '';
            });
            
            validationSummary.classList.remove('show');
        }

        function validateForm() {
            clearAllErrors();
            
            const errors = [];
            let firstErrorField = null;
            
            // Focus on critical fields: email and phone number
            
            // Email validation (most critical)
            const email = document.getElementById('email').value.trim();
            if (!email) {
                showFieldError('email', '❌ Email address is required. Please enter your email (e.g., "john@example.com").');
                errors.push('Enter your email address');
                if (!firstErrorField) firstErrorField = 'email';
            } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                showFieldError('email', '❌ Invalid email format. Please use format: your@email.com (include @ and domain).');
                errors.push('Fix email format (need @ and .com)');
                if (!firstErrorField) firstErrorField = 'email';
            } else {
                clearFieldError('email');
            }

            // Phone number validation (digits only, 10-15 digits)
            const phone = document.getElementById('phone').value.trim();
            if (!phone) {
                showFieldError('phone', '❌ Phone number is required. Enter digits only (e.g., "7144008283").');
                errors.push('Enter your phone number');
                if (!firstErrorField) firstErrorField = 'phone';
            } else {
                const phoneDigits = phone.replace(/\D/g, ''); // Remove all non-digits
                if (phoneDigits !== phone) {
                    showFieldError('phone', '❌ Phone number must contain digits only (no letters or symbols).');
                    errors.push('Phone number must be digits only');
                    if (!firstErrorField) firstErrorField = 'phone';
                } else if (phone.length < 10) {
                    showFieldError('phone', `❌ Phone number too short. You entered ${phone.length} digits, need at least 10.`);
                    errors.push('Phone number needs at least 10 digits');
                    if (!firstErrorField) firstErrorField = 'phone';
                } else if (phone.length > 15) {
                    showFieldError('phone', `❌ Phone number too long. You entered ${phone.length} digits, maximum is 15.`);
                    errors.push('Phone number too long (max 15 digits)');
                    if (!firstErrorField) firstErrorField = 'phone';
                } else {
                    clearFieldError('phone');
                }
            }

            // Basic required fields (less strict)
            const firstName = document.getElementById('firstName').value.trim();
            if (!firstName) {
                showFieldError('firstName', '❌ First name is required. Please enter your first name.');
                errors.push('Enter your first name');
                if (!firstErrorField) firstErrorField = 'firstName';
            } else {
                clearFieldError('firstName');
            }

            const lastName = document.getElementById('lastName').value.trim();
            if (!lastName) {
                showFieldError('lastName', '❌ Last name is required. Please enter your last name.');
                errors.push('Enter your last name');
                if (!firstErrorField) firstErrorField = 'lastName';
            } else {
                clearFieldError('lastName');
            }

            const grade = document.getElementById('grade').value;
            if (!grade) {
                showFieldError('grade', 'ℹ️ Please select your grade level to help us customize your tutoring.');
                errors.push('Select your grade level');
                if (!firstErrorField) firstErrorField = 'grade';
            } else {
                clearFieldError('grade');
            }

            // Validate subjects
            const subjectCheckboxes = document.querySelectorAll('input[name="subjects"]:checked');
            if (subjectCheckboxes.length === 0) {
                showFieldError('subjects', '❌ At least one subject is required. Please check the boxes for subjects you need help with (e.g., Algebra, Calculus, etc.).');
                errors.push('Select at least one subject you need help with');
                if (!firstErrorField) firstErrorField = 'subjects';
            } else {
                clearFieldError('subjects');
            }

            // Parent phone validation (optional) - digits only
            const parentPhone = document.getElementById('parentPhone').value.trim();
            if (parentPhone) {
                const parentPhoneDigits = parentPhone.replace(/\D/g, ''); // Remove all non-digits
                if (parentPhoneDigits !== parentPhone) {
                    showFieldError('parentPhone', '❌ Parent phone number must contain digits only (no letters or symbols).');
                    errors.push('Parent phone number must be digits only');
                    if (!firstErrorField) firstErrorField = 'parentPhone';
                } else if (parentPhone.length < 10) {
                    showFieldError('parentPhone', `❌ Parent phone number too short. You entered ${parentPhone.length} digits, need at least 10.`);
                    errors.push('Parent phone number needs at least 10 digits');
                    if (!firstErrorField) firstErrorField = 'parentPhone';
                } else if (parentPhone.length > 15) {
                    showFieldError('parentPhone', `❌ Parent phone number too long. You entered ${parentPhone.length} digits, maximum is 15.`);
                    errors.push('Parent phone number too long (max 15 digits)');
                    if (!firstErrorField) firstErrorField = 'parentPhone';
                } else {
                    clearFieldError('parentPhone');
                }
            }

            // Show validation summary if there are errors
            if (errors.length > 0) {
                const validationSummary = document.getElementById('validationSummary');
                const validationList = document.getElementById('validationList');
                
                validationList.innerHTML = '';
                errors.forEach(error => {
                    const li = document.createElement('li');
                    li.textContent = error;
                    validationList.appendChild(li);
                });
                
                validationSummary.classList.add('show');
                validationSummary.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                // Focus on first error field
                if (firstErrorField) {
                    setTimeout(() => {
                        document.getElementById(firstErrorField).focus();
                    }, 300);
                }
                
                return false;
            }

            return true;
        }





        // Phone number formatting functions - digits only
        function isDigitOnly(event) {
            const char = String.fromCharCode(event.which);
            
            // Allow digits 0-9 only
            if (/[0-9]/.test(char)) {
                return true;
            }
            
            // Allow backspace, delete, tab, escape, enter
            if ([8, 9, 27, 13, 46].indexOf(event.keyCode) !== -1 ||
                // Allow Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X
                (event.keyCode === 65 && event.ctrlKey === true) ||
                (event.keyCode === 67 && event.ctrlKey === true) ||
                (event.keyCode === 86 && event.ctrlKey === true) ||
                (event.keyCode === 88 && event.ctrlKey === true)) {
                return true;
            }
            
            // Prevent all other characters
            event.preventDefault();
            return false;
        }
        
        function formatPhoneDigits(input) {
            // Remove all non-digit characters
            let value = input.value.replace(/\D/g, '');
            
            // Limit length to 15 digits
            if (value.length > 15) {
                value = value.substring(0, 15);
            }
            
            input.value = value;
            
            // Update visual feedback
            const phoneError = document.getElementById('phone-error');
            
            if (value.length > 0 && value.length < 10) {
                input.style.borderColor = '#ffc107'; // Warning color
                if (phoneError) {
                    phoneError.textContent = `${value.length}/10 digits minimum`;
                    phoneError.style.color = '#856404';
                    phoneError.style.display = 'block';
                }
            } else if (value.length >= 10 && value.length <= 15) {
                input.style.borderColor = '#28a745'; // Success color
                if (phoneError) {
                    phoneError.textContent = '';
                    phoneError.style.display = 'none';
                }
            } else if (value.length > 15) {
                input.style.borderColor = '#dc3545'; // Error color
                if (phoneError) {
                    phoneError.textContent = 'Maximum 15 digits allowed';
                    phoneError.style.color = '#dc3545';
                    phoneError.style.display = 'block';
                }
            } else {
                input.style.borderColor = '';
                if (phoneError) {
                    phoneError.textContent = '';
                    phoneError.style.display = 'none';
                }
            }
        }
        
        function handlePhonePaste(event) {
            // Allow paste but clean it up to digits only
            setTimeout(() => {
                formatPhoneDigits(event.target);
            }, 0);
        }



        document.getElementById('registrationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const loadingIndicator = document.getElementById('loadingIndicator');
            
            console.log('Form submitted, running validation...');
            
            // Validate form first
            if (!validateForm()) {
                console.log('Validation failed, form submission stopped');
                return; // Stop here if validation fails
            }
            
            console.log('Validation passed, proceeding with submission...');
            
            // Show loading
            submitBtn.disabled = true;
            loadingIndicator.style.display = 'block';
            
            try {
                const formData = new FormData(this);
                
                // Get selected subjects
                const subjects = [];
                const subjectCheckboxes = document.querySelectorAll('input[name="subjects"]:checked');
                subjectCheckboxes.forEach(checkbox => {
                    subjects.push(checkbox.value);
                });
                
                // Get preferred times from checkboxes
                const preferredTimes = [];
                const checkedDays = document.querySelectorAll('input[name="scheduleDay"]:checked');
                
                checkedDays.forEach(dayCheckbox => {
                    const day = dayCheckbox.value;
                    const dayLower = day.toLowerCase();
                    const timeInput = document.querySelector(`input[name="${dayLower}Time"]`);
                    const time = timeInput.value.trim();
                    
                    if (time) {
                        preferredTimes.push({
                            day: day,
                            time: time
                        });
                    }
                });
                
                // Prepare data for submission
                const registrationData = {
                    firstName: formData.get('firstName'),
                    lastName: formData.get('lastName'),
                    email: formData.get('email'),
                    phone: formData.get('phone'),
                    grade: formData.get('grade'),
                    country: formData.get('country'),
                    timezone: formData.get('timezone'),
                    subjects: subjects,
                    preferredTimes: preferredTimes,
                    parentName: formData.get('parentName'),
                    parentEmail: formData.get('parentEmail'),
                    parentPhone: formData.get('parentPhone'),
                    goals: formData.get('goals'),
                    experience: formData.get('experience')
                };
                
                console.log('📤 Sending registration data:', registrationData);
                
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(registrationData)
                });
                
                console.log('📥 Server response status:', response.status, response.statusText);
                console.log('📥 Response headers:', response.headers);
                console.log('📥 Response OK:', response.ok);
                
                // Check if response is okay and can be parsed as JSON
                if (!response.ok) {
                    console.log('❌ Server returned error status:', response.status);
                    let errorData = null;
                    
                    try {
                        errorData = await response.json();
                        console.log('📄 Error response data:', errorData);
                    } catch (parseError) {
                        console.log('⚠️ Could not parse error response as JSON:', parseError);
                        // Show generic server error
                        showModal(
                            'error',
                            'Server Error ❌',
                            `<strong>Unable to connect to server:</strong><br><br>
                            <div style="background: #ffebee; border: 1px solid #f44336; border-radius: 5px; padding: 15px; margin: 10px 0;">
                                <strong>Error:</strong> Server error (${response.status}): ${response.statusText}
                            </div>
                            <strong>Please try:</strong><br>
                            • Check your internet connection<br>
                            • Refresh the page and try again<br>
                            • Contact us if the problem continues<br><br>
                            📧 khan.apcalculus@gmail.com<br>
                            📱 714-400-8283`
                        );
                        return;
                    }
                    
                    // Handle validation errors differently than server errors
                    if (errorData && errorData.type === 'validation') {
                        console.log('⚠️ Validation errors found, showing user-friendly guidance');
                        console.log('📝 Error data details:', errorData);
                        console.log('📝 Error list:', errorData.errors);
                        
                        const errorList = errorData.errors || [];
                        console.log('📝 Processing error list:', errorList);
                        
                        const errorListHtml = errorList.map(error => `<li style="margin: 5px 0;">${error}</li>`).join('');
                        console.log('📝 Generated HTML:', errorListHtml);
                        
                        const modalContent = `<strong>We found some issues that need your attention:</strong><br><br>
                            <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px; padding: 15px; margin: 10px 0;">
                                <ul style="margin: 0; padding-left: 20px; text-align: left;">
                                    ${errorListHtml}
                                </ul>
                            </div>
                            <strong>What to do next:</strong><br>
                            • Review the issues listed above<br>
                            • Make the necessary corrections in the form<br>
                            • Click "Submit Registration" again<br><br>
                            <strong>Need help?</strong> Contact us:<br>
                            📧 khan.apcalculus@gmail.com<br>
                            📱 714-400-8283`;
                        
                        console.log('📝 Final modal content:', modalContent);
                        
                        showModal(
                            'warning',
                            'Please Check Your Information ⚠️',
                            modalContent
                        );
                    } else {
                        // Show generic server error for non-validation issues
                        const errorMessage = errorData?.message || 'Registration failed. Please try again.';
                        showModal(
                            'error',
                            'Registration Failed ❌',
                            `<strong>Sorry, registration could not be completed:</strong><br><br>
                            <div style="background: #ffebee; border: 1px solid #f44336; border-radius: 5px; padding: 15px; margin: 10px 0;">
                                <strong>Error:</strong> ${errorMessage}
                            </div>
                            <strong>What you can do:</strong><br>
                            • Check the information you entered<br>
                            • Try again in a few moments<br>
                            • Contact us directly if the problem persists<br><br>
                            📧 khan.apcalculus@gmail.com<br>
                            📱 714-400-8283`
                        );
                    }
                    return; // Exit early for server errors
                }
                
                const result = await response.json();
                console.log('📄 Server response data:', result);
                
                if (result.success) {
                    console.log('✅ Registration successful!');
                    // Show success modal
                    showModal(
                        'success',
                        'Registration Successful! 🎉',
                        `<strong>${result.message}</strong><br><br>
                        ✅ We've received your registration<br>
                        📧 <strong>Check your email for confirmation</strong><br>
                        📞 We'll contact you within 24 hours<br>
                        🎁 <strong>Your first session is FREE!</strong><br><br>
                        <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px; padding: 10px; margin-top: 15px;">
                        <strong>📨 Important:</strong> If you don't see our email in your inbox:<br>
                        • Check your <strong>Spam/Junk folder</strong><br>
                        • Add <strong>khan.apcalculus@gmail.com</strong> to your contacts<br>
                        • Look for email from <strong>"LCC360 Tutoring"</strong>
                        </div>`,
                        () => {
                            // Reset form when modal is closed
                            this.reset();
                            window.scrollTo({ top: 0, behavior: 'smooth' });
                        }
                    );
                } else {
                    console.log('⚠️ Server returned success=false:', result.message);
                    // Handle server issues (non-validation errors)
                    const errorMessage = result.message || 'Registration failed due to server error';
                    
                    console.log('🚨 Displaying server error modal with message:', errorMessage);
                    showModal(
                        'error',
                        'Registration Error ❌',
                        `<strong>Unable to complete registration:</strong><br><br>
                        <div style="background: #ffebee; border: 1px solid #f44336; border-radius: 5px; padding: 15px; margin: 10px 0;">
                            <strong>Server Issue:</strong> ${errorMessage}
                        </div>
                        <strong>What you can do:</strong><br>
                        • Try submitting again in a few moments<br>
                        • Check your internet connection<br>
                        • Contact us if the problem continues<br><br>
                        📧 khan.apcalculus@gmail.com<br>
                        📱 714-400-8283`
                    );
                }
                
            } catch (error) {
                console.error('💥 Network/Connection error:', error);
                
                // This should only catch network errors, not validation or server errors
                showModal(
                    'error',
                    'Connection Problem ❌',
                    `<strong>Unable to connect to the server:</strong><br><br>
                    <div style="background: #ffebee; border: 1px solid #f44336; border-radius: 5px; padding: 15px; margin: 10px 0;">
                        <strong>Network Error:</strong> ${error.message}
                    </div>
                    <strong>Please try these steps:</strong><br>
                    • Check your internet connection<br>
                    • Refresh this page and try again<br>
                    • If the problem persists, contact us directly<br><br>
                    📧 khan.apcalculus@gmail.com<br>
                    📱 714-400-8283<br><br>
                    <em>Your information has been saved in the form, so you won't lose your entries.</em>`
                );
            } finally {
                submitBtn.disabled = false;
                loadingIndicator.style.display = 'none';
                console.log('🔄 Form submission complete, buttons re-enabled');
            }
        });
    </script>
</body>
</html> 